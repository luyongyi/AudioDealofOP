# 概述
大概讲述自己在以前工作中，对于高人力依赖的测试团队的测试方案优化思路

## 两人测试场景优化
一般是需要一个人做动作，另一个人实时评测的场景  ，两个人不能在同一环境下，也不能做单人优化的场景  
比如说直播，通话，微信电话等  
  
核心逻辑是DUT人力流程用扬声器替代，AUX端取消工位，使用技术手段采集  
但要注意这里一般会因为业务迭代有几个妥协点，不能一蹴而就  
1.仍然需要人力验证，不信任扬声器发声：可以只在AUX端使用技术手段采集，这样效果可以做留档多人评审，同时还可以和项目同步验证，不干扰旧流程正常进行。  
2.信任扬声器发声，但是异常没有能力用算法识别：DUT场景搭建使用人工，测试过程使用扬声器发声，AUX端使用人力评测  
3.信任扬声器，有能力做异常识别和场景评测：到这里核心逻辑才是是DUT人力流程用扬声器和UIControl替代，AUX端取消工位  
4.直接测试手机音频ID调用，取消和网络和三方软件的耦合  
### 直播/RTMP推流软件
以抖音直播测试为例  
如果以黑盒形式测试，只完成所谓用户场景测试任务，就会有以下测试方案：  
<div align="center">
<figure>
    <img src="photo/测试部分流程图/初级测试，黑盒测试场景.png" alt="图片描述" />
    <figcaption>图1:黑盒测试思路</figcaption>
</figure>
</div>  

优势 ：   
1.能够快速响应和完成场景搭建  
2.门槛简单，思路清晰，符合直觉  
劣势：  
1.测试用例写法繁琐复杂  
2.人员需要培训，无法立即上手
3.人力需求大，测试需要两人且占用两静音房
  
此时如果稍加优化，可以在原来基础上不反直觉的做AUX端优化，DUT测试员可以直接做完一整套场景，若组员短时间内不认可，也可以在原有测试基础上只做测试过程数据采集，如下图所示  

<div align="center">
<figure>
    <img src="photo/测试部分流程图/优化AUX端的流程方式.png" alt="图片描述" />
    <figcaption>图2:保留测试方式下，AUX端优化思路</figcaption>
</figure>
</div>   

如果组员认可，那就可以达成单人测试双端场景。若不认可，可以把音视频保存作为备用方案，方便以后测试回溯。  
优势：能够不干扰以前测试逻辑下做测试回溯且能单人做完两人场景测试   

如果再进一步，这里就可以直接对DUT要测试的场景做标准化拆分了，将DUT人力用喇叭组和人工嘴做模拟，如下图所示：
<div align="center">
<figure>
    <img src="photo/测试部分流程图/DUT人力替换.png" alt="图片描述" />
    <figcaption>图3:DUT端人力替换</figcaption>
</figure>
</div>  

此流程标准化后可以完全替代人力，架设好器具和设备后，手机操作使用UIautomator等库完成，喇叭和人工嘴操作使用正常控制声卡播放的库即可。简单来说有几个优劣：  
优势：  
1.能做场景标准化，可以固化测试输入，留存测试输出  
2.测试和评测时空分离，可以在A1时间点A2静音房完成的测试，在A3时间点A4机器上完成评测。  
3.可以对测试结果音频文件做技术性评测
4.节省测试人力  


劣势：  
1.如果设计UI自动化相关，测开投入大  
2.需要对场景标准化和用户场景有深刻理解  

如果测开能力足够支持，可以继续抽象测试方式，DUT端本身就是测试整个机器MIC端到抖音APP读入的Track流，可以使用一个仿抖音直播模块读取方式（在Log端行为调用一模一样，包括PackageName）  
如下图所示  

<div align="center">
<figure>
    <img src="photo/测试部分流程图/摒除黑盒思路，拆解链路，回归测试本质.png" alt="图片描述" />
    <figcaption>图4:拆解链路，仿APP形式测试</figcaption>
</figure>
</div>  

这里的抖音APP实际是需要一个仿抖音PackageName的录制软件，模拟抖音自身的录制调用，抓取出此类调用的效果  
如果再进行细致管控，可以直接对Log内音频节点输出进行管控，包括tunning参数和中间节点效果都可以进行管控，相关思路如下：  

<div align="center">
<figure>
    <img src="photo/测试部分流程图/抽象内链路评测.png" alt="图片描述" />
    <figcaption>图5:抽象的内链路测试</figcaption>
</figure>
</div>  


### 通话
通话原理也是如此，如果是手机公司，AUX可以是一台标准的通话下行所有模块bypass的定制版本，上行仅做普通增益，其余模块均bypass，以便做仅采集数据的机型。  
一般来说通话软件无法模拟，可以定制版本嵌入通话模拟软件
普通公司可以使用网络电话做AUX端，特别是一些没有自主能力的ODM&外包公司。
### VOIP（IM软件通话，QQ微信等语音聊天）
原理同通话，但是实际上VOIP类软件有自带的降噪/回音/增益处理，需要评估其3A模型强度和参数。评估原理需要自建场景，输入输出取Track节点评估即可。  
能够使用仿PackageName软件模拟输入输出。


### 会议（VOIP群聊形式，但又有所不同）
会议场景就是多人群聊下的VOIP场景，但是会议场景下软件自带的AEC处理强度会比较大，AGC也会拉的很高很平均，所以还是有所不同，降噪强度普遍也要大一些，因为会议场景更实际注重人声表现。所以在评估其3A算法强度的时候会发现其参数要拉比较高一些，不符合高保真音频表现。  
也可以按照此思路优化，但是注意部分场景要和VOIP区分开，评估算法设计时要着重人声的表现。